# 2.值表达式

涵盖
- 常量或文字值
- 列引用
- 函数定义或准备好的语句主体中的位置参数引用
- 下标表达式
- 字段选择表达式
- 操作符调用
- 聚合表达式
- 窗口函数调用
- 类型转换
- 排序表达式
- 标量子查询
- 数组构造函数
- 行构造函数
- 括号中的另一个值表达式（用于对子表达式进行分组并覆盖优先级）
  
1.列引用  
表.列名（列名唯一可以不用引用）
```
correlation.columnname
```

2.位置参数  
TODO(JT)-位置参数应用场景

3.下标
```
-- 数组
expression[subscript]
-- 数组切片
expression[ lower_subscript: upper_subscript]
```

4.字段选择
表达式/表.字段名
```
expression.fieldname
mytable.mycolumn
$1.somecolumn
(rowfunction(a,b)).col3
(compositecol).somefield
(mytable.compositecol).somefield
(compositecol).*
```

5.运算符调用
```
OPERATOR(schema.operatorname)
```

6.函数调用
```
function_name ([expression [, expression ... ]] )
```

7.聚合表达式
```
aggregate_name (expression [ , ... ] [ order_by_clause ] ) [ FILTER ( WHERE filter_clause ) ]
aggregate_name (ALL expression [ , ... ] [ order_by_clause ] ) [ FILTER ( WHERE filter_clause ) ]
aggregate_name (DISTINCT expression [ , ... ] [ order_by_clause ] ) [ FILTER ( WHERE filter_clause ) ]
aggregate_name ( * ) [ FILTER ( WHERE filter_clause ) ]
aggregate_name ( [ expression [ , ... ] ] ) WITHIN GROUP ( order_by_clause ) [ FILTER ( WHERE filter_clause ) ]
```
其中aggregate_name是先前定义的聚合函数（可能使用模式名限定），并且expression是任意值表达式
例：
```
SELECT
    count(*) AS unfiltered,
    count(*) FILTER (WHERE i < 5) AS filtered
FROM generate_series(1,10) AS s(i);
```
分组聚合  
使用GROUP BY (column_name) HAVING  

常用聚合函数  
SUM(), AVG(), COUNT(), MAX(), MIN()

8.窗口函数调用(TODO?)  
```
function_name ([expression [, expression ... ]]) [ FILTER ( WHERE filter_clause ) ] OVER window_name
function_name ([expression [, expression ... ]]) [ FILTER ( WHERE filter_clause ) ] OVER ( window_definition )
function_name ( * ) [ FILTER ( WHERE filter_clause ) ] OVER window_name
function_name ( * ) [ FILTER ( WHERE filter_clause ) ] OVER ( window_definition )
```

9.类型转换
```
CAST ( expression AS type )
expression::type
```

10.排序表达式
```
expr COLLATE collation
```

11.标量-子查询
```
SELECT name, (SELECT max(pop) FROM cities WHERE cities.state = states.name)
    FROM states;
```

12.数组构造函数
```
SELECT ARRAY[1,2,3+4];
```

13.行构造函数
```
SELECT ROW(1,2.5,'this is a test');
```

14.表达式求值规则
```
SELECT true OR somefunc();
```

