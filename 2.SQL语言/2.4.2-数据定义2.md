## 4.约束  
数据类型提供的约束过于宽泛；“约束”赋予控制权  
4.1 检查约束  
需要满足布尔值表达式的检验  
```
CREATE TABLE products (
    product_no integer,
    name text,
    price numeric CHECK (price > 0)
);
```
4.2 非空约束  
列不能为空
```
CREATE TABLE products (
    product_no integer NOT NULL,
    name text NOT NULL,
    price numeric
);
```
4.3 唯一约束  
一列或者一组列不允许重复
```
CREATE TABLE products (
    product_no integer UNIQUE,
    name text,
    price numeric
);
```
组唯一
```
CREATE TABLE example (
    a integer,
    b integer,
    c integer,
    UNIQUE (a, c)
);
```
约束命名
```
CREATE TABLE products (
    product_no integer CONSTRAINT must_be_different UNIQUE,
    name text,
    price numeric
);
```
4.4 主键  
一列或一组唯一标识，且不能为空
```
CREATE TABLE products (
    product_no integer PRIMARY KEY,
    name text,
    price numeric
);
```
等价于：
```
CREATE TABLE products (
    product_no integer UNIQUE NOT NULL,
    name text,
    price numeric
);
```
4.5 外键  
一列或者一组列与另外表的一行匹配  

引用表
```
CREATE TABLE products (
    product_no integer PRIMARY KEY,
    name text,
    price numeric
);

CREATE TABLE orders (
    order_id integer PRIMARY KEY,
    product_no integer REFERENCES products (product_no),
    quantity integer
);
```
product_no不为空
不指定列的情况下默认选择主键列  
如：
```
CREATE TABLE orders (
    order_id integer PRIMARY KEY,
    product_no integer REFERENCES products,
    quantity integer
);
```
外键组引用
```
CREATE TABLE t1 (
  a integer PRIMARY KEY,
  b integer,
  c integer,
  FOREIGN KEY (b, c) REFERENCES other_table (c1, c2)
);
```
多个外键，多对多
```
CREATE TABLE products (
    product_no integer PRIMARY KEY,
    name text,
    price numeric
);

CREATE TABLE orders (
    order_id integer PRIMARY KEY,
    shipping_address text,
    ...
);

CREATE TABLE order_items (
    product_no integer REFERENCES products,
    order_id integer REFERENCES orders,
    quantity integer,
    PRIMARY KEY (product_no, order_id)
);
```
删除操作
```
CREATE TABLE products (
    product_no integer PRIMARY KEY,
    name text,
    price numeric
);

CREATE TABLE orders (
    order_id integer PRIMARY KEY,
    shipping_address text,
    ...
);

CREATE TABLE order_items (
    product_no integer REFERENCES products ON DELETE RESTRICT,
    order_id integer REFERENCES orders ON DELETE CASCADE,
    quantity integer,
    PRIMARY KEY (product_no, order_id)
);
```
限制和级联删除：  
`RESTRICT` 防止删除引用的行 `NO ACTION` 会在检查约束的时候报错  
`CASCASE` 删除行的时候，自动删除引用行  

其它方式 `SET NULL`和`SET DEFAULT`：  
这些选项分别导致引用行中的引用列设置为空值或其默认值。 请注意，这些并不能免除您遵守任何约束。 例如，如果操作指定SET DEFAULT但默认值不满足外键约束，则操作将失败。  

4.6 排除(它)约束  
如果使用指定的运算符在指定的列或表达式上比较任意两行，则这些运算符比较中至少有一个将返回 false 或 null  
```
CREATE TABLE circles (
    c circle,
    EXCLUDE USING gist (c WITH &&)  -- 禁止圆圈范围重叠
);
```
操作符	支持 `=`（等价唯一约束）、`&&`（范围禁止重叠） 等任意操作符 


## 5.系统列

系统会偷偷加几个隐式定义的系统列。这些列不能用作用户定义列的名称  

`tableoid`  
包含此行的表的OID。此列对于从分区表或继承层次结构中进行选择的查询特别方便，因为如果没有它，就很难判断一行来自哪个单独的表。可以将与列tableoid连接起来以获取表名。oidpg_class  

`xmin`  
此行版本的插入事务的标识（事务 ID）。（行版本是行的独立状态；每次更新一行都会为同一逻辑行创建一个新的行版本。）  

`cmin`  
插入事务内的命令标识符（从零开始）。  

`xmax`  
删除事务的标识（事务 ID），对于未删除的行版本则为零。在可见的行版本中，此列可能为非零值。这通常表示删除事务尚未提交，或者尝试删除的操作已被回滚。  

`cmax`  
删除事务内的命令标识符或零。  

`ctid`  
行版本在其表中的物理位置。请注意，虽然ctid可以用来快速定位行版本，但如果ctid 被 更新或移动， 的 也会发生变化VACUUM FULL。因此ctid无法用作长期行标识符。应使用主键来标识逻辑行。